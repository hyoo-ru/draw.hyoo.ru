<!doctype html>
<html style="height: 100%; width: 100%">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1.0">

		<meta name="mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<link rel="manifest" href="hyoo/draw/manifest.json">
		<link href="hyoo/draw/logo/logo.svg" rel="icon" />
	</head>
	<body style="margin: 0; padding: 0; height: 100%; width: 100%">
		<div mol_view_root="$hyoo_draw"></div>
		<script>
			if( location.hostname !== 'localhost' ) {
				
				self.onerror = function( msg, url, line, col, err ) {
					const el = document.activeElement
					fetch( 'https://notify.bugsnag.com/', {
						method: 'post',
						body: JSON.stringify({
							apiKey: "18acf016ed2a2a4cc4445daa9dd2dd3c",
							payloadVersion: 5,
							notifier: {
								name: '$hyoo',
								version: '1',
								url: 'inline',
							},
							events: [{
								device: {
									locale: navigator.language,
									userAgent: navigator.userAgent,
									time: new Date().toISOString(),
								},
								context: el && el.id,
								exceptions: [{
									message: err && err.message || err || msg,
									errorClass: err && err.constructor.name,
									stacktrace: [{
										columnNumber: col,
										file: url,
										lineNumber: line,
										method: 'unknown',
									}],
								}],
								metaData: {
									stack: err && err.stack,
								},
								request: {
									url: document.location.href,
									referer: document.referrer,
								},
							}],
						})
					} )
				}
				
				console.onunhandledrejection = function( event ) {
					self.onerror( 'Unhandled Rejection', '', 0, 0, event.reason )
				} 
				
				const error = console.error
				console.error = function() {
					error.apply( console, arguments )
					self.onerror( 'Logged Error', '', 0, 0, arguments[0] )
				}
				
			}
		</script>
		<script src="web.js" charset="utf-8"></script>
	
				<script src="/mol/build/client/client.js" charset="utf-8"></script>
				<script>
					setTimeout( ()=> {

						const test = document.createElement( 'script' )
						test.src = 'web.test.js'
						
						const audit =  document.createElement( 'script' )
						audit.src = 'web.audit.js'
						
						test.onload = ()=> document.head.appendChild( audit )
						document.head.appendChild( test )

					}, 250 )
				</script>
				</body>
</html>
